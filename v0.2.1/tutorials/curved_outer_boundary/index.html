<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Curved outer boundary · HOHQMesh.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://trixi-framework.github.io/HOHQMesh.jl/stable/tutorials/curved_outer_boundary/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">HOHQMesh.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Interactive mesh generation</span><ul><li><a class="tocitem" href="../../interactive_overview/">Overview</a></li><li><a class="tocitem" href="../../guided-tour/">Guided tour</a></li><li><a class="tocitem" href="../../interactive-api/">API</a></li><li><a class="tocitem" href="../../CheatSheet/">Commands Cheat Sheet</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../introduction/">Overview</a></li><li><a class="tocitem" href="../straight_outer_boundary/">Straight-sided outer boundary</a></li><li class="is-active"><a class="tocitem" href>Curved outer boundary</a><ul class="internal"><li><a class="tocitem" href="#Initialization"><span>Initialization</span></a></li><li><a class="tocitem" href="#Add-the-outer-boundary"><span>Add the outer boundary</span></a></li><li><a class="tocitem" href="#Add-a-background-grid"><span>Add a background grid</span></a></li><li><a class="tocitem" href="#Initial-mesh-and-user-adjustments"><span>Initial mesh and user adjustments</span></a></li><li><a class="tocitem" href="#Final-mesh"><span>Final mesh</span></a></li><li><a class="tocitem" href="#Summary"><span>Summary</span></a></li></ul></li><li><a class="tocitem" href="../spline_curves/">Spline curves</a></li><li><a class="tocitem" href="../create_edit_curves/">Creating and editing curves</a></li></ul></li><li><span class="tocitem">Advanced topics &amp; developers</span><ul><li><a class="tocitem" href="../../development/">Development</a></li><li><a class="tocitem" href="../../github-git/">GitHub &amp; Git</a></li><li><a class="tocitem" href="../../testing/">Testing</a></li></ul></li><li><a class="tocitem" href="../../reference/">Reference</a></li><li><a class="tocitem" href="../../authors/">Authors</a></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li><li><a class="tocitem" href="../../license/">License</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Curved outer boundary</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Curved outer boundary</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/trixi-framework/HOHQMesh.jl/blob/main/docs/src/tutorials/curved_outer_boundary.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Curved-outer-boundary"><a class="docs-heading-anchor" href="#Curved-outer-boundary">Curved outer boundary</a><a id="Curved-outer-boundary-1"></a><a class="docs-heading-anchor-permalink" href="#Curved-outer-boundary" title="Permalink"></a></h1><p>The purpose of this tutorial is to demonstrate how to create an unstructured mesh on a domain with a curved outer boundary. This outer boundary curve is defined by parametric equations and contains fine features as well as smooth regions.</p><p>The outer boundary, background grid and mesh are visualized for quality inspection. The tutorial also shows how to adjust the background and add a local refinement region in order to better resolve a portion of the curved boundary.</p><h3 id="Synopsis"><a class="docs-heading-anchor" href="#Synopsis">Synopsis</a><a id="Synopsis-1"></a><a class="docs-heading-anchor-permalink" href="#Synopsis" title="Permalink"></a></h3><p>This tutorial demonstrates how to:</p><ul><li>Define a curved outer boundary using parametric equations.</li><li>Add and adjust the background grid.</li><li>Visualize an interactive mesh project.</li><li>Add manual refinement to a local region of the domain.</li></ul><h2 id="Initialization"><a class="docs-heading-anchor" href="#Initialization">Initialization</a><a id="Initialization-1"></a><a class="docs-heading-anchor-permalink" href="#Initialization" title="Permalink"></a></h2><p>From a Julia REPL we load the HOHQMesh package as well as <a href="https://github.com/JuliaPlots/GLMakie.jl/">GLMakie</a>, a backend of <a href="https://github.com/JuliaPlots/Makie.jl/">Makie.jl</a>, to visualize the boundary curve, mesh, etc. from the interactive tool.</p><pre><code class="language-julia hljs">julia&gt; using GLMakie, HOHQMesh</code></pre><p>Now we are ready to interactively generate unstructured quadrilateral meshes!</p><p>We create a new project with the name <code>&quot;TheBlob&quot;</code> and assign <code>&quot;out&quot;</code> to be the folder where any output files from the mesh generation process will be saved. By default, the output files created by HOHQMesh will carry the same name as the project. For example, the resulting mesh file from this tutorial will be named <code>TheBlob.mesh</code>. If the folder <code>out</code> does not exist, it will be created automatically in the current file path.</p><pre><code class="language-julia hljs">blob_project = newProject(&quot;TheBlob&quot;, &quot;out&quot;)</code></pre><h2 id="Add-the-outer-boundary"><a class="docs-heading-anchor" href="#Add-the-outer-boundary">Add the outer boundary</a><a id="Add-the-outer-boundary-1"></a><a class="docs-heading-anchor-permalink" href="#Add-the-outer-boundary" title="Permalink"></a></h2><p>The outer boundary curve for the domain of interest in this tutorial is given by the parametric equations</p><p class="math-container">\[  \begin{aligned}
    x(t) &amp;= 4\cos(2 \pi t) - \frac{3}{5}\cos^3(8 \pi t),\\[0.2cm]
    y(t) &amp;= 4\sin(2 \pi t) - \frac{1}{2}\sin^2(11 \pi t),\\[0.2cm]
    z(t) &amp;= 0
  \end{aligned}
  \qquad
  t\in[0,1]\]</p><p>Parametric equations in HOHQMesh can be any legitimate equation and use intrinsic functions available in Fortran, e.g., <span>$\sin$</span>, <span>$\cos$</span>, exp. The constant <code>pi</code> is available for use. Exponentiation is done with <code>^</code>. All number literals are interpreted as floating point numbers.</p><p>The following commands create a new curve for the parametric equations above</p><pre><code class="language-julia hljs">xEqn = &quot;x(t) = 4 * cos(2 * pi * t) - 0.6 * cos(8 * pi * t)^3&quot;
yEqn = &quot;y(t) = 4 * sin(2 * pi * t) - 0.5 * sin(11* pi * t)^2&quot;
zEqn = &quot;z(t) = 0.0&quot;
blob = newParametricEquationCurve(&quot;Blob&quot;, xEqn, yEqn, zEqn)</code></pre><p>The name of this curve is assigned to be <code>&quot;Blob&quot;</code>. This name is also the label that HOHQMesh will give to this boundary curve in the resulting mesh file.</p><p>Now that we have created the boundary curve it must be added as an outer boundary in the <code>blob_project</code>.</p><pre><code class="language-julia hljs">addCurveToOuterBoundary!(blob_project, blob)</code></pre><h2 id="Add-a-background-grid"><a class="docs-heading-anchor" href="#Add-a-background-grid">Add a background grid</a><a id="Add-a-background-grid-1"></a><a class="docs-heading-anchor-permalink" href="#Add-a-background-grid" title="Permalink"></a></h2><p>HOHQMesh requires a background grid for the mesh generation process. This background grid sets the base resolution of the desired mesh. HOHQMesh will automatically subdivide from this background grid near sharp features of any curved boundaries.</p><p>For a domain bounded by an outer boundary curve, this background grid is set by indicating the desired element size in the <span>$x$</span> and <span>$y$</span> directions. To start, we set the background grid for <code>blob_project</code> to have elements with side length two in each direction</p><pre><code class="language-julia hljs">addBackgroundGrid!(blob_project, [2.0, 2.0, 0.0])</code></pre><p>We next visualize the outer boundary curve and background grid with the following</p><pre><code class="language-julia hljs">plotProject!(blob_project, MODEL+GRID)</code></pre><p>Here, we take the sum of the keywords <code>MODEL</code> and <code>GRID</code> in order to simultaneously visualize the curves and background grid. The resulting plot is given below. The chain of outer boundary curves is called <code>&quot;Outer&quot;</code> and it contains a single curve <code>&quot;Blob&quot;</code> labeled in the figure by <code>O.1</code>.</p><p><img src="https://user-images.githubusercontent.com/25242486/174747035-f21bb8d1-386f-4036-b2e8-59e264c071d1.png" alt="coarse_grid"/></p><p>From the visualization we see that the background grid is likely too coarse to produce a &quot;good&quot; quadrilateral mesh for this domain. We reset the background grid size to have elements with size one half in each direction</p><pre><code class="language-julia hljs">setBackgroundGridSize!(blob_project, 0.5, 0.5)</code></pre><p>Note, that after we execute the command above the visualization updates automatically with the outer boundary curve and the new background grid.</p><p><img src="https://user-images.githubusercontent.com/25242486/174747046-f1bc9734-ef4e-4e4c-9055-c54ebe1537e7.png" alt="fine_grid"/></p><p>The new background grid that gives a finer initial resolution looks suitable to continue to the mesh generation.</p><h2 id="Initial-mesh-and-user-adjustments"><a class="docs-heading-anchor" href="#Initial-mesh-and-user-adjustments">Initial mesh and user adjustments</a><a id="Initial-mesh-and-user-adjustments-1"></a><a class="docs-heading-anchor-permalink" href="#Initial-mesh-and-user-adjustments" title="Permalink"></a></h2><p>We next generate the mesh from the information contained in the <code>blob_project</code>. This will output the following files to the <code>out</code> folder:</p><ul><li><code>TheBlob.control</code>: A HOHQMesh control file for the current project.</li><li><code>TheBlob.tec</code>: A TecPlot formatted file to visualize the mesh with other software, e.g., <a href="https://www.paraview.org/">ParaView</a>.</li><li><code>TheBlob.mesh</code>: A mesh file with format <code>ISM-V2</code> (the default format).</li></ul><p>To do this we execute the command</p><pre><code class="language-julia hljs">generate_mesh(blob_project)

 *******************
 2D Mesh Statistics:
 *******************
    Total time             =   0.10612399999999998
    Number of nodes        =          481
    Number of Edges        =          895
    Number of Elements     =          417
    Number of Subdivisions =            5

 Mesh Quality:
         Measure         Minimum         Maximum         Average  Acceptable Low Acceptable High       Reference
     Signed Area      0.00025346      0.36181966      0.11936327      0.00000000    999.99900000      1.00000000
    Aspect Ratio      1.00002883      2.58066393      1.26340310      1.00000000    999.99900000      1.00000000
       Condition      1.00000000      3.11480166      1.18583253      1.00000000      4.00000000      1.00000000
      Edge Ratio      1.00006177      4.80707901      1.51313656      1.00000000      4.00000000      1.00000000
        Jacobian      0.00011326      0.28172540      0.10292251      0.00000000    999.99900000      1.00000000
   Minimum Angle     29.30873612     89.99827738     73.08079323     40.00000000     90.00000000     90.00000000
   Maximum Angle     90.00132792    156.87642432    109.37004979     90.00000000    135.00000000     90.00000000
       Area Sign      1.00000000      1.00000000      1.00000000      1.00000000      1.00000000      1.00000000</code></pre><p>The call to <code>generate_mesh</code> also prints mesh quality statistics to the screen and updates the visualization. The background grid is <em>removed</em> from the visualization when the mesh is generated.</p><div class="admonition is-info"><header class="admonition-header">Mesh visualization</header><div class="admonition-body"><p>Currently, only the &quot;skeleton&quot; of the mesh is visualized. Thus, the high-order curved boundary information is not seen in the plot but this information <strong>is present</strong> in the generated mesh file.</p></div></div><p><img src="https://user-images.githubusercontent.com/25242486/174747052-d0776ca6-5451-4d9f-accb-8d97b2db1c26.png" alt="initial_blob"/></p><p>Inspecting the mesh we see that the automatic subdivision in HOHQMesh does well to capture the fine features of the curved outer boundary. Although, we see that the mesh near the point <span>$(-4, 0)$</span> is still quite coarse. To remedy this we manually add a <code>RefinementCenter</code> near this region of the domain to force HOHQMesh to increase the resolution in this area. We create and add this refinement region to the current project with</p><pre><code class="language-julia hljs">center = newRefinementCenter(&quot;region&quot;, &quot;smooth&quot;, [-4.0, -0.5, 0.0], 0.4, 1.0)
addRefinementRegion!(blob_project, center)</code></pre><p>Above we create a circular refinement region centered at the point <span>$(-4, -0.5)$</span> with a desired resolution size <span>$0.4$</span> and a radius of <span>$1.0$</span>. Upon adding this refinement region to <code>blob_project</code>, the visualization will update to indicate the location and size of the manual refinement region.</p><p><img src="https://user-images.githubusercontent.com/25242486/174747059-1f58ae14-aeec-48d5-afb3-6a0614a8e29d.png" alt="refinement_blob"/></p><h2 id="Final-mesh"><a class="docs-heading-anchor" href="#Final-mesh">Final mesh</a><a id="Final-mesh-1"></a><a class="docs-heading-anchor-permalink" href="#Final-mesh" title="Permalink"></a></h2><p>With the refinement region added to the project we can regenerate the mesh. Note, this will create and save new output files <code>TheBlob.control</code>, <code>TheBlob.tec</code>, <code>TheBlob.mesh</code> and update the figure.</p><pre><code class="language-julia hljs">generate_mesh(blob_project)

 *******************
 2D Mesh Statistics:
 *******************
    Total time             =   0.11373499999999999
    Number of nodes        =          505
    Number of Edges        =          940
    Number of Elements     =          438
    Number of Subdivisions =            5

 Mesh Quality:
         Measure         Minimum         Maximum         Average  Acceptable Low Acceptable High       Reference
     Signed Area      0.00025346      0.36181966      0.11412658      0.00000000    999.99900000      1.00000000
    Aspect Ratio      1.00002884      2.47585614      1.26424390      1.00000000    999.99900000      1.00000000
       Condition      1.00000000      3.11480166      1.18425870      1.00000000      4.00000000      1.00000000
      Edge Ratio      1.00006177      4.80707901      1.51413601      1.00000000      4.00000000      1.00000000
        Jacobian      0.00011326      0.28172540      0.09814547      0.00000000    999.99900000      1.00000000
   Minimum Angle     29.30873612     89.99827901     72.79596483     40.00000000     90.00000000     90.00000000
   Maximum Angle     90.00132782    156.87642433    109.63912468     90.00000000    135.00000000     90.00000000
       Area Sign      1.00000000      1.00000000      1.00000000      1.00000000      1.00000000      1.00000000</code></pre><p>Note, the circular region indicating the refinement center is removed from the plot when the mesh is generated.</p><p><img src="https://user-images.githubusercontent.com/25242486/174747066-a804bf1d-508a-480d-bde3-47687b402604.png" alt="final_blob"/></p><p>Now we decide that we are satisfied with the mesh quality and resolution of the outer boundary curve.</p><h2 id="Summary"><a class="docs-heading-anchor" href="#Summary">Summary</a><a id="Summary-1"></a><a class="docs-heading-anchor-permalink" href="#Summary" title="Permalink"></a></h2><p>In this tutorial we demonstrated how to:</p><ul><li>Define a curved outer boundary using parametric equations.</li><li>Add and adjust the background grid.</li><li>Visualize an interactive mesh project.</li><li>Add manual refinement to a local region of the domain.</li></ul><p>For completeness, we include a script with all the commands to generate the mesh displayed in the final image. Note, we <strong>do not</strong> include the plotting in this script.</p><pre><code class="language-julia hljs"># Interactive mesh with a curved outer boundary
#
# Create an outer boundary from a set of parametric equations.
# Add manual refinement in a small region around the point (-4, -0.5).
#
# Keywords: outer boundary, parametric equations, refinement center
using HOHQMesh

# Instantiate the project
blob_project = newProject(&quot;TheBlob&quot;, &quot;out&quot;)

# Create and add the outer boundary curve
xEqn = &quot;x(t) = 4 * cos(2 * pi * t) - 0.6 * cos(8 * pi * t)^3&quot;
yEqn = &quot;y(t) = 4 * sin(2 * pi * t) - 0.5 * sin(11* pi * t)^2&quot;
zEqn = &quot;z(t) = 0.0&quot;
blob = newParametricEquationCurve(&quot;Blob&quot;, xEqn, yEqn, zEqn)
addCurveToOuterBoundary!(blob_project, blob)

# Add the background grid
addBackgroundGrid!(blob_project, [0.5, 0.5, 0.0])

# Create and add the refinement region
center = newRefinementCenter(&quot;region&quot;, &quot;smooth&quot;, [-4.0, -0.5, 0.0], 0.4, 1.0)
addRefinementRegion!(blob_project, center)

# Generate the mesh
generate_mesh(blob_project)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../straight_outer_boundary/">« Straight-sided outer boundary</a><a class="docs-footer-nextpage" href="../spline_curves/">Spline curves »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 13 October 2023 09:29">Friday 13 October 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
