<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Creating and editing curves · HOHQMesh.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://trixi-framework.github.io/HOHQMesh.jl/stable/tutorials/create_edit_curves/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">HOHQMesh.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Interactive mesh generation</span><ul><li><a class="tocitem" href="../../interactive_overview/">Overview</a></li><li><a class="tocitem" href="../../guided-tour/">Guided tour</a></li><li><a class="tocitem" href="../../interactive-api/">API</a></li><li><a class="tocitem" href="../../CheatSheet/">Commands Cheat Sheet</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../introduction/">Overview</a></li><li><a class="tocitem" href="../straight_outer_boundary/">Straight-sided outer boundary</a></li><li><a class="tocitem" href="../curved_outer_boundary/">Curved outer boundary</a></li><li><a class="tocitem" href="../spline_curves/">Spline curves</a></li><li class="is-active"><a class="tocitem" href>Creating and editing curves</a><ul class="internal"><li><a class="tocitem" href="#Initialization"><span>Initialization</span></a></li><li><a class="tocitem" href="#Add-the-outer-boundary-chain"><span>Add the outer boundary chain</span></a></li><li><a class="tocitem" href="#Add-a-background-grid"><span>Add a background grid</span></a></li><li><a class="tocitem" href="#Edit-the-outer-boundary-chain"><span>Edit the outer boundary chain</span></a></li><li><a class="tocitem" href="#Add-an-inner-boundary-chain"><span>Add an inner boundary chain</span></a></li><li><a class="tocitem" href="#Generate-the-mesh"><span>Generate the mesh</span></a></li><li><a class="tocitem" href="#Delete-the-existing-mesh"><span>Delete the existing mesh</span></a></li><li><a class="tocitem" href="#Edit-an-inner-boundary-chain"><span>Edit an inner boundary chain</span></a></li><li><a class="tocitem" href="#Regenerate-the-mesh"><span>Regenerate the mesh</span></a></li><li><a class="tocitem" href="#Summary"><span>Summary</span></a></li></ul></li></ul></li><li><span class="tocitem">Advanced topics &amp; developers</span><ul><li><a class="tocitem" href="../../development/">Development</a></li><li><a class="tocitem" href="../../github-git/">GitHub &amp; Git</a></li><li><a class="tocitem" href="../../testing/">Testing</a></li></ul></li><li><a class="tocitem" href="../../reference/">Reference</a></li><li><a class="tocitem" href="../../authors/">Authors</a></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li><li><a class="tocitem" href="../../license/">License</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Creating and editing curves</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Creating and editing curves</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/trixi-framework/HOHQMesh.jl/blob/main/docs/src/tutorials/create_edit_curves.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Creating-and-editing-curves"><a class="docs-heading-anchor" href="#Creating-and-editing-curves">Creating and editing curves</a><a id="Creating-and-editing-curves-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-and-editing-curves" title="Permalink"></a></h1><p>The purpose of this tutorial is to demonstrate how to inner and outer boundary curve chains. By a &quot;chain&quot; we mean a closed curve that is composed of multiple pieces. Each chain can be a combination of different curve types, e.g., a circular arc can connect to a spline. It also shows how to modify, remove, and add new pieces to an existing curve chain. The <code>undo</code> and <code>redo</code> capabilities of the interactive mesh tool are briefly discussed. The outer and inner boundary curves, background grid as well as the mesh will be visualized for quality inspection.</p><h3 id="Synopsis"><a class="docs-heading-anchor" href="#Synopsis">Synopsis</a><a id="Synopsis-1"></a><a class="docs-heading-anchor-permalink" href="#Synopsis" title="Permalink"></a></h3><p>This tutorial demonstrates how to:</p><ul><li>Create and edit an outer boundary chain.</li><li>Create and edit an inner boundary chain.</li><li>Add the background grid when an outer boundary curve is present.</li><li>Visualize an interactive mesh project.</li><li>Discuss undo / redo capabilities.</li><li>Construct and add parametric spline curves.</li><li>Construct and add a curve from parametric equations.</li><li>Construct and add straight line segments.</li><li>Construct and add circular arc segments.</li></ul><h2 id="Initialization"><a class="docs-heading-anchor" href="#Initialization">Initialization</a><a id="Initialization-1"></a><a class="docs-heading-anchor-permalink" href="#Initialization" title="Permalink"></a></h2><p>From a Julia REPL we load the HOHQMesh package as well as <a href="https://github.com/JuliaPlots/GLMakie.jl/">GLMakie</a>, a backend of <a href="https://github.com/JuliaPlots/Makie.jl/">Makie.jl</a>, to visualize the curves, mesh, etc. from the interactive tool.</p><pre><code class="language-julia hljs">julia&gt; using GLMakie, HOHQMesh</code></pre><p>Now we are ready to interactively generate unstructured quadrilateral meshes!</p><p>We create a new project with the name <code>&quot;sandbox&quot;</code> and assign <code>&quot;out&quot;</code> to be the folder where any output files from the mesh generation process will be saved. By default, the output files created by HOHQMesh will carry the same name as the project. For example, the resulting HOHQMesh control file from this tutorial will be named <code>sandbox.control</code>. If the folder <code>out</code> does not exist, it will be created automatically in the current file path.</p><pre><code class="language-julia hljs">sandbox_project = newProject(&quot;sandbox&quot;, &quot;out&quot;)</code></pre><h2 id="Add-the-outer-boundary-chain"><a class="docs-heading-anchor" href="#Add-the-outer-boundary-chain">Add the outer boundary chain</a><a id="Add-the-outer-boundary-chain-1"></a><a class="docs-heading-anchor-permalink" href="#Add-the-outer-boundary-chain" title="Permalink"></a></h2><p>We first create the outer boundary curve chain that is composed of three pieces</p><ol><li>Straight line segment from <span>$(0, -7)$</span> to <span>$(5, 3)$</span>.</li><li>Half-circle arc of radius <span>$r=5$</span> centered at <span>$(0, 3)$</span>.</li><li>Straight line segment from <span>$(-5, 3)$</span> to <span>$(0, -7)$</span>.</li></ol><p>Each segment of the curve is created separately. The straight line segments are made with the function <code>newEndPointsLineCurve</code> and given unique names:</p><pre><code class="language-julia hljs">outer_line1 = newEndPointsLineCurve(&quot;Line1&quot;,          # curve name
                                    [0.0, -7.0, 0.0], # start point
                                    [5.0,  3.0, 0.0]) # end point

outer_line2 = newEndPointsLineCurve(&quot;Line2&quot;,          # curve name
                                    [-5.0, 3.0, 0.0], # start point
                                    [0.0, -7.0, 0.0]) # end point</code></pre><p>To create the circle arc we use the function <code>newCircularArcCurve</code> where we specify a name for the curve as well as the radius and center of the circle. The arc can have an arbitrary length dictated by the start and end angle, e.g., for a half-circle we take the angle to vary from <span>$0$</span> to <span>$180$</span> degrees.</p><pre><code class="language-julia hljs">outer_arc = newCircularArcCurve(&quot;Arc&quot;,           # curve name
                                [0.0, 3.0, 0.0], # center
                                5.0,             # radius
                                0.0,             # start angle
                                180.0,           # end angle
                                &quot;degrees&quot;)       # units for angle</code></pre><p>We use <code>&quot;degrees&quot;</code> to set the angle bounds, but <code>&quot;radians&quot;</code> can also be used. The name of the curve stored in the dictionary <code>outer_arc</code> is assigned to be <code>&quot;Arc&quot;</code>.</p><p>The curve names  <code>&quot;Line1&quot;</code>, <code>&quot;Line2&quot;</code>, and <code>&quot;Arc&quot;</code> are the labels that HOHQMesh will give to these boundary curve segments in the resulting mesh file.</p><p>The three curve segments stored in the variables <code>outer_line1</code>, <code>outer_line2</code>, and <code>outer_arc</code> are then added to the <code>sandbox_project</code> with a counter-clockwise orientation as required by HOHQMesh.</p><pre><code class="language-julia hljs">addCurveToOuterBoundary!(sandbox_project, outer_line1)
addCurveToOuterBoundary!(sandbox_project, outer_arc)
addCurveToOuterBoundary!(sandbox_project, outer_line2)</code></pre><h2 id="Add-a-background-grid"><a class="docs-heading-anchor" href="#Add-a-background-grid">Add a background grid</a><a id="Add-a-background-grid-1"></a><a class="docs-heading-anchor-permalink" href="#Add-a-background-grid" title="Permalink"></a></h2><p>HOHQMesh requires a background grid for the mesh generation process. This background grid sets the base resolution of the desired mesh. HOHQMesh will automatically subdivide from this background grid near sharp features of any curved boundaries.</p><p>For a domain bounded by an outer boundary curve, this background grid is set by indicating the desired element size in the <span>$x$</span> and <span>$y$</span> directions. To start, we set the background grid for <code>sandbox_project</code> to have elements with side length one in each direction</p><pre><code class="language-julia hljs">addBackgroundGrid!(sandbox_project, [1.0, 1.0, 0.0])</code></pre><p>We visualize the outer boundary curve chain and background grid with the following</p><pre><code class="language-julia hljs">plotProject!(sandbox_project, MODEL+GRID)</code></pre><p>Here, we take the sum of the keywords <code>MODEL</code> and <code>GRID</code> in order to simultaneously visualize the outer boundary and background grid. The resulting plot is given below. The chain of outer boundary curves is called <code>&quot;Outer&quot;</code> and it contains three curve segments <code>&quot;Line1&quot;</code>, <code>&quot;Arc&quot;</code>, and <code>&quot;Line2&quot;</code> labeled in the figure by <code>O.1</code>, <code>O.2</code>, and <code>O.3</code>, respectively.</p><p><img src="https://user-images.githubusercontent.com/25242486/175062627-a87ed6e1-ce68-4ef4-a178-96b1ccceff0a.png" alt="background_grid"/></p><h2 id="Edit-the-outer-boundary-chain"><a class="docs-heading-anchor" href="#Edit-the-outer-boundary-chain">Edit the outer boundary chain</a><a id="Edit-the-outer-boundary-chain-1"></a><a class="docs-heading-anchor-permalink" href="#Edit-the-outer-boundary-chain" title="Permalink"></a></h2><p>Suppose that the domain boundary requires a curved segment instead of the straight line <code>&quot;Line2&quot;</code>. We will replace this line segment in the outer boundary chain with a cubic spline.</p><p>First, we remove the <code>&quot;Line2&quot;</code> curve from the <code>&quot;Outer&quot;</code> chain with the command</p><pre><code class="language-julia hljs">removeOuterBoundaryCurveWithName!(sandbox_project, &quot;Line2&quot;)</code></pre><div class="admonition is-success"><header class="admonition-header">Outer curve removal</header><div class="admonition-body"><p>Alternatively, we can remove the curve <code>&quot;Line2&quot;</code> using its index in the <code>&quot;Outer&quot;</code> boundary chain.</p><pre><code class="language-julia hljs">removeOuterBoundaryCurveAtIndex!(sandbox_project, 3)</code></pre><p>This removal strategy is useful when the curves in the boundary chain do not have unique names. Be aware that when curves are removed from a chain it is possible that the indexing of the remaining curves changes.</p></div></div><p>The plot automatically updates and we see that the outer boundary is open and contains two segments: <code>&quot;Line1&quot;</code> and <code>&quot;Arc&quot;</code>.</p><p><img src="https://user-images.githubusercontent.com/25242486/175062663-8a0e3a4f-c444-4302-a35b-7565095ab78a.png" alt="outer_removal"/></p><p>Next, we create a parametric cubic spline curve from a given set of data points. In order to make a closed outer boundary chain the cubic spline must begin at the endpoint of the curve <code>&quot;Arc&quot;</code> and end at the first point of the curve <code>&quot;Line1&quot;</code>. This ensures that the new spline curve connects into the boundary curve chain with the correct orientation. To create a parametric spline curve we directly provide data points in the code. These points take the form <code>[t, x, y, z]</code> where <code>t</code> is the parameter variable that varies between <span>$0$</span> and <span>$1$</span>. The spline curve constructor <code>newSplineCurve</code> also takes the number of points as an input argument.</p><pre><code class="language-julia hljs">spline_data = [ [0.0  -5.0  3.0 0.0]
                [0.25 -2.0  1.0 0.0]
                [0.5  -4.0  0.5 0.0]
                [0.75 -2.0 -3.0 0.0]
                [1.0   0.0 -7.0 0.0] ]
outer_spline = newSplineCurve(&quot;Spline&quot;, 5, spline_data)</code></pre><p>Now we add the spline curve <code>outer_spline</code> into the <code>sandbox_project</code>.</p><pre><code class="language-julia hljs">addCurveToOuterBoundary!(sandbox_project, outer_spline)</code></pre><p>The figure updates automatically to display the <code>&quot;Outer&quot;</code> boundary chain with the new <code>&quot;Spline&quot;</code> curve labeled <code>O.3</code>.</p><p><img src="https://user-images.githubusercontent.com/25242486/175062706-6d12840c-f5fa-49e6-ad18-d46d643dd3d8.png" alt="outer_spline"/></p><h2 id="Add-an-inner-boundary-chain"><a class="docs-heading-anchor" href="#Add-an-inner-boundary-chain">Add an inner boundary chain</a><a id="Add-an-inner-boundary-chain-1"></a><a class="docs-heading-anchor-permalink" href="#Add-an-inner-boundary-chain" title="Permalink"></a></h2><p>We create a pill shaped inner boundary curve chain composed of four pieces</p><ol><li>Straight line segment from <span>$(1, 5)$</span> to <span>$(1, 3)$</span>.</li><li>Half-circle arc of radius <span>$r=1$</span> centered at <span>$(0, 3)$</span>.</li><li>Straight line segment from <span>$(-1, 3)$</span> to <span>$(-1, 5)$</span>.</li><li>Half-circle arc of radius <span>$r=1$</span> centered at <span>$(0, 5)$</span>.</li></ol><p>Similar to the construction of the <code>&quot;Outer&quot;</code> boundary chain, each segment of this inner boundary chain is created separately. The straight line segments are made with the function <code>newEndPointsLineCurve</code> and given unique names:</p><pre><code class="language-julia hljs">inner_line1 = newEndPointsLineCurve(&quot;Line1&quot;,         # curve name
                                    [1.0, 5.0, 0.0], # start point
                                    [1.0, 3.0, 0.0]) # end point

inner_line2 = newEndPointsLineCurve(&quot;Line2&quot;,          # curve name
                                    [-1.0, 3.0, 0.0], # start point
                                    [-1.0, 5.0, 0.0]) # end point</code></pre><p>To create the circle arcs we use the function <code>newCircularArcCurve</code> where we specify a name for the curve as well as the radius and center of the circle. In order to create an inner curve chain with counter-clockwise orientation the angle for the bottom half-circle arc centered at <span>$(0, 3)$</span> varies from <span>$0$</span> to <span>$-180$</span> degrees. The top half-circle arc centered at <span>$(0, 5)$</span> has an angle that varies from <span>$180$</span> to <span>$0$</span> degrees. The construction of the two circle arcs are</p><pre><code class="language-julia hljs">inner_bottom_arc = newCircularArcCurve(&quot;BottomArc&quot;,     # curve name
                                       [0.0, 3.0, 0.0], # center
                                       1.0,             # radius
                                       0.0,             # start angle
                                       -pi,             # end angle
                                       &quot;radians&quot;)       # units for angle

inner_top_arc = newCircularArcCurve(&quot;TopArc&quot;,        # curve name
                                    [0.0, 5.0, 0.0], # center
                                    1.0,             # radius
                                    180.0,           # start angle
                                    0.0,             # end angle
                                    &quot;degrees&quot;)       # units for angle</code></pre><p>Note, we use <code>&quot;radians&quot;</code> to set the angle bounds for <code>inner_bottom_arc</code> and <code>&quot;degrees&quot;</code> for the angle bounds of <code>inner_top_arc</code>.</p><p>The curve names  <code>&quot;Line1&quot;</code>, <code>&quot;Line2&quot;</code>, <code>&quot;BottomArc&quot;</code>, and <code>&quot;TopArc&quot;</code> are the labels that HOHQMesh will give to these inner boundary curve segments in the resulting mesh file.</p><p>The four curve segments stored in the variables <code>inner_line1</code>, <code>inner_line2</code>, <code>inner_bottom_arc</code> and <code>outer_arc</code> are added to the <code>sandbox_project</code> in  counter-clockwise order as required by HOHQMesh.</p><pre><code class="language-julia hljs">addCurveToInnerBoundary!(sandbox_project, inner_line1,      &quot;inner&quot;)
addCurveToInnerBoundary!(sandbox_project, inner_bottom_arc, &quot;inner&quot;)
addCurveToInnerBoundary!(sandbox_project, inner_line2,      &quot;inner&quot;)
addCurveToInnerBoundary!(sandbox_project, inner_top_arc,    &quot;inner&quot;)</code></pre><p>This inner boundary chain name <code>&quot;inner&quot;</code> is used internally by HOHQMesh. The visualization of the background grid automatically detects that curves have been added to the <code>sandbox_project</code> and the plot is updated, as shown below. The chain for the inner boundary curve chain is called <code>inner</code> and it contains a four curve segments <code>&quot;Line1&quot;</code>, <code>&quot;BottomArc&quot;</code>, <code>&quot;Line2&quot;</code>, and <code>&quot;TopArc&quot;</code> labeled in the figure by <code>1.1</code>, <code>1.2</code>, <code>1.3</code>, and <code>1.4</code>, respectively.</p><p><img src="https://user-images.githubusercontent.com/25242486/175062834-91aae24d-167d-4d0f-8d39-887ab189081b.png" alt="inner_pill"/></p><h2 id="Generate-the-mesh"><a class="docs-heading-anchor" href="#Generate-the-mesh">Generate the mesh</a><a id="Generate-the-mesh-1"></a><a class="docs-heading-anchor-permalink" href="#Generate-the-mesh" title="Permalink"></a></h2><p>We next generate the mesh from the information contained in the <code>sandbox_project</code>. This will output the following files to the <code>out</code> folder:</p><ul><li><code>sandbox.control</code>: A HOHQMesh control file for the current project.</li><li><code>sandbox.tec</code>: A TecPlot formatted file to visualize the mesh with other software, e.g., <a href="https://www.paraview.org/">ParaView</a>.</li><li><code>sandbox.mesh</code>: A mesh file with format <code>ISM-V2</code> (the default format).</li></ul><p>To do this we execute the command</p><pre><code class="language-julia hljs">generate_mesh(sandbox_project)

 *******************
 2D Mesh Statistics:
 *******************
    Total time             =    7.5414000000000009E-002
    Number of nodes        =          511
    Number of Edges        =          933
    Number of Elements     =          422
    Number of Subdivisions =            7

 Mesh Quality:
         Measure         Minimum         Maximum         Average  Acceptable Low Acceptable High       Reference
     Signed Area      0.00002932      1.17335568      0.18813138      0.00000000    999.99900000      1.00000000
    Aspect Ratio      1.00953438      2.30790024      1.31439620      1.00000000    999.99900000      1.00000000
       Condition      1.00041663      2.41773865      1.21024584      1.00000000      4.00000000      1.00000000
      Edge Ratio      1.01673809      3.68828437      1.59413340      1.00000000      4.00000000      1.00000000
        Jacobian      0.00001750      1.13820387      0.14143901      0.00000000    999.99900000      1.00000000
   Minimum Angle     32.22733574     89.35690571     68.75321248     40.00000000     90.00000000     90.00000000
   Maximum Angle     90.61089476    152.37947944    113.36221513     90.00000000    135.00000000     90.00000000
       Area Sign      1.00000000      1.00000000      1.00000000      1.00000000      1.00000000      1.00000000</code></pre><p>The call to <code>generate_mesh</code> also prints mesh quality statistics to the screen and updates the visualization. The background grid is <em>removed</em> from the visualization when the mesh is generated.</p><div class="admonition is-info"><header class="admonition-header">Mesh visualization</header><div class="admonition-body"><p>Currently, only the &quot;skeleton&quot; of the mesh is visualized. Thus, the high-order curved boundary information is not seen in the plot but this information <strong>is present</strong> in the generated mesh file.</p></div></div><p><img src="https://user-images.githubusercontent.com/25242486/175062901-4f1280ae-9830-4ab3-bee2-76f895b03cbb.png" alt="initial_mesh"/></p><h2 id="Delete-the-existing-mesh"><a class="docs-heading-anchor" href="#Delete-the-existing-mesh">Delete the existing mesh</a><a id="Delete-the-existing-mesh-1"></a><a class="docs-heading-anchor-permalink" href="#Delete-the-existing-mesh" title="Permalink"></a></h2><p>In preparation of edits we will make to the inner boundary chain we remove the current mesh from the plot and re-plot the model curves and background grid. Note, this step is not required, but it helps avoid confusion when editing several curves.</p><pre><code class="language-julia hljs">remove_mesh!(sandbox_project)
updatePlot!(sandbox_project, MODEL+GRID)</code></pre><p>Additionally, the <code>remove_mesh!</code> command deletes the mesh information from the <code>sandbox_project</code> and <code>sandbox.mesh</code> from the <code>out</code> folder. However, the <code>sandbox.control</code> and <code>sandbox.tec</code> files are still present in <code>out</code> directory.</p><h2 id="Edit-an-inner-boundary-chain"><a class="docs-heading-anchor" href="#Edit-an-inner-boundary-chain">Edit an inner boundary chain</a><a id="Edit-an-inner-boundary-chain-1"></a><a class="docs-heading-anchor-permalink" href="#Edit-an-inner-boundary-chain" title="Permalink"></a></h2><p>Suppose that the inner boundary actually requires a curved segment instead of the straight line <code>&quot;Line1&quot;</code>. We will replace this line segment in the inner boundary chain with an oscillating segment construct from a set of parametric equations. In doing so, it will also be necessary to remove the <code>BottomArc</code> and replace it with a new, wider circular arc segment.</p><p>We remove the <code>&quot;Line1&quot;</code> curve from the <code>inner</code> chain with the command</p><pre><code class="language-julia hljs">removeInnerBoundaryCurve!(sandbox_project, &quot;Line1&quot;, &quot;inner&quot;)</code></pre><div class="admonition is-success"><header class="admonition-header">Inner curve removal</header><div class="admonition-body"><p>Alternatively, we can remove the curve <code>&quot;Line1&quot;</code> using its index in the <code>inner</code> boundary chain.</p><pre><code class="language-julia hljs">removeInnerBoundaryCurveAtIndex!(sandbox_project, 1, &quot;inner&quot;)</code></pre><p>This removal strategy is useful when the curves in the boundary chain do not have unique names. Be aware that when curves are removed from a chain it is possible that the indexing of the remaining curves changes.</p></div></div><p>With either removal strategy, the plot automatically updates. We see that the inner boundary is open and contains three segments: <code>&quot;BottomArc&quot;</code>, <code>&quot;Line2&quot;</code>, and <code>&quot;TopArc&quot;</code>. Note that the index of the remaining curves has changed as shown below.</p><p><img src="https://user-images.githubusercontent.com/25242486/175062997-6f60b3e3-b9eb-4f6b-8062-5b17de0cca2c.png" alt="inner_removal"/></p><div class="admonition is-info"><header class="admonition-header">Brief note about undo / redo</header><div class="admonition-body"><p>The interactive functionality (globally) carries an operation stack of actions that can be undone (or redone) as the case may be. We can query and print to the REPL the top of the undo stack with <code>undoActionName</code>.</p><pre><code class="language-julia hljs">undoActionName()
&quot;Remove Inner Boundary Curve&quot;</code></pre><p>We can undo the removal of the <code>&quot;Line1&quot;</code> curve with <code>undo</code></p><pre><code class="language-julia hljs">undo()
&quot;Undo Remove Inner Boundary Curve&quot;</code></pre><p>In addition to reinstating <code>&quot;Line1&quot;</code> into the <code>sandbox_project</code>, this undo prints the action that was undone to the REPL and will update the figure.</p><p>Analogously, there is a redo operation stack. We query and print to the REPL the top the redo stack with <code>redoActionName</code> and can use <code>redo</code> to perform the operation.</p></div></div><p>The new inner curve segment will be an oscillating line given by the parametric equations</p><p class="math-container">\[  \begin{aligned}
    x(t) &amp;= t + 1,\\[0.2cm]
    y(t) &amp;= -2t + 5 - \frac{3}{2} \cos(\pi t) \sin(\pi t),\\[0.2cm]
    z(t) &amp;= 0
  \end{aligned}
  \qquad
  t\in[0,1]\]</p><p>Parametric equations in HOHQMesh can be any legitimate equation and use intrinsic functions available in Fortran, e.g., <span>$\sin$</span>, <span>$\cos$</span>, exp. The constant <code>pi</code> is available for use. The following commands create a new curve for the parametric equations above</p><pre><code class="language-julia hljs">xEqn = &quot;x(t) = t + 1&quot;
yEqn = &quot;y(t) = -2 * t + 5 - 1.5 * cos(pi * t) * sin(pi * t)&quot;
zEqn = &quot;z(t) = 0.0&quot;
inner_eqn = newParametricEquationCurve(&quot;wiggleLine&quot;, xEqn, yEqn, zEqn)</code></pre><p>The name of this new curve is assigned to be <code>&quot;wiggleLine&quot;</code>. We add this new curve to the <code>&quot;inner&quot;</code> chain.</p><pre><code class="language-julia hljs">addCurveToInnerBoundary!(sandbox_project, inner_eqn, &quot;inner&quot;)</code></pre><p>The automatically updated figure now shows:</p><p><img src="https://user-images.githubusercontent.com/25242486/175063103-e8eda78c-b0d9-4229-9383-5582845d5f81.png" alt="inner_open_chain"/></p><p>We see from the figure that this parametric equation curve starts at the point <span>$(1,5)$</span> and, therefore, matches the end point of the existing curve <code>&quot;TopArc&quot;</code> present in the <code>&quot;inner&quot;</code> chain. However, the parametric equation curve ends at the point <span>$(2,3)$</span> which <strong>does not</strong> match the <code>&quot;BottomArc&quot;</code> curve. So, the inner boundary chain remains open.</p><div class="admonition is-warning"><header class="admonition-header">Attempt to generate a mesh with an open curve chain</header><div class="admonition-body"><p>An open curve chain is <strong>invalid</strong> in HOHQMesh. All inner and/or outer curve chains must be closed. If we attempt to send a project that contains an open curve chain to <code>generate_mesh</code> a warning is thrown and no mesh or output files are generated.</p></div></div><p>To create a closed boundary curve we must remove the <code>&quot;BottomArc&quot;</code> curve and replace it with a wider half-circle arc segment. This new half-circle arc must start at the point <span>$(2, 3)$</span> and end at the point <span>$(-1, 3)$</span> to close the inner chain <strong>and</strong> guarantee the chain is oriented counter-clockwise. So, we first remove the <code>&quot;BottomArc&quot;</code> from the <code>&quot;inner&quot;</code> chain.</p><pre><code class="language-julia hljs">removeInnerBoundaryCurve!(sandbox_project, &quot;BottomArc&quot;, &quot;inner&quot;)</code></pre><p>The figure updates to display the <code>&quot;inner&quot;</code> curve chain with three segments. Note that the inner curve chain indexing has, again, been automatically adjusted.</p><p><img src="https://user-images.githubusercontent.com/25242486/175063146-9475697a-3aa8-42c1-abdb-713343c6b8f7.png" alt="inner_remove_arc"/></p><p>A half-circle arc that joins the points <span>$(2, 3)$</span> and <span>$(-1, 3)$</span> has a radius <span>$r=1.5$</span>, is centered at <span>$(0.5, 3)$</span> and has an angle that vaires from <span>$0$</span> to <span>$-180$</span>. We construct this circle arc and directly add it to the <code>sandbox_project</code>.</p><pre><code class="language-julia hljs">new_bottom_arc = newCircularArcCurve(&quot;wideBottomArc&quot;, # curve name
                                     [0.5, 3.0, 0.0], # center
                                     1.5,             # radius
                                     0.0,             # start angle
                                     -pi,             # end angle
                                     &quot;radians&quot;)       # units for angle
addCurveToInnerBoundary!(sandbox_project, new_bottom_arc, &quot;inner&quot;)</code></pre><p>The updated plot now gives the modified, closed inner curve chain that now contains four curve segments <code>&quot;Line2&quot;</code>, <code>&quot;TopArc&quot;</code>, <code>&quot;wiggleLine&quot;</code>, and <code>&quot;wideBottomArc&quot;</code> labeled in the figure by <code>1.1</code>, <code>1.2</code>, <code>1.3</code>, and <code>1.4</code>, respectively.</p><p><img src="https://user-images.githubusercontent.com/25242486/175063184-9c2d1204-cdcd-4a33-88bd-d73e7183b3d6.png" alt="inner_modified"/></p><h2 id="Regenerate-the-mesh"><a class="docs-heading-anchor" href="#Regenerate-the-mesh">Regenerate the mesh</a><a id="Regenerate-the-mesh-1"></a><a class="docs-heading-anchor-permalink" href="#Regenerate-the-mesh" title="Permalink"></a></h2><p>With the modifications to the inner curve chain complete we can regenerate the mesh. This will create a new <code>sandbox.mesh</code> file and overwrite the existing <code>sandbox.control</code> and <code>sandbox.tec</code> files in the <code>out</code> directory.</p><pre><code class="language-julia hljs">generate_mesh(sandbox_project)

 *******************
 2D Mesh Statistics:
 *******************
    Total time             =   0.11353599999999998
    Number of nodes        =          712
    Number of Edges        =         1308
    Number of Elements     =          596
    Number of Subdivisions =            7

 Mesh Quality:
         Measure         Minimum         Maximum         Average  Acceptable Low Acceptable High       Reference
     Signed Area      0.00002932      1.15661960      0.12823902      0.00000000    999.99900000      1.00000000
    Aspect Ratio      1.01050856      3.14732001      1.34260027      1.00000000    999.99900000      1.00000000
       Condition      1.00037771      2.59434067      1.22850175      1.00000000      4.00000000      1.00000000
      Edge Ratio      1.02744717      3.68828437      1.64751502      1.00000000      4.00000000      1.00000000
        Jacobian      0.00001750      1.13149451      0.09443920      0.00000000    999.99900000      1.00000000
   Minimum Angle     31.87236189     89.33988565     67.86178629     40.00000000     90.00000000     90.00000000
   Maximum Angle     90.44177106    157.27121105    114.35699650     90.00000000    135.00000000     90.00000000
       Area Sign      1.00000000      1.00000000      1.00000000      1.00000000      1.00000000      1.00000000</code></pre><p>The visualization updates automatically and the background grid is <em>removed</em> after when the mesh is generated.</p><p><img src="https://user-images.githubusercontent.com/25242486/175063283-b60d8985-0fce-4010-90c5-5a924883a895.png" alt="inner_modified"/></p><p>Inspecting the mesh we see that the automatic subdivision in HOHQMesh does well to capture the sharp corners and fine features of the curved inner and outer boundaries. For example, we zoom into sharp corner at the bottom of the domain and see that, although small, the elements in this region maintain a good quadrilateral shape.</p><p><img src="https://user-images.githubusercontent.com/25242486/175063320-57d42322-2d0e-4e69-b177-ab40d6a8df3d.png" alt="zoom_corner"/></p><h2 id="Summary"><a class="docs-heading-anchor" href="#Summary">Summary</a><a id="Summary-1"></a><a class="docs-heading-anchor-permalink" href="#Summary" title="Permalink"></a></h2><p>In this tutorial we demonstrated how to:</p><ul><li>Create and edit an outer boundary chain.</li><li>Create and edit an inner boundary chain.</li><li>Add the background grid when an outer boundary curve is present.</li><li>Visualize an interactive mesh project.</li><li>Discuss undo / redo capabilities.</li><li>Construct and add parametric spline curves.</li><li>Construct and add a curve from parametric equations.</li><li>Construct and add straight line segments.</li><li>Construct and add circular arc segments.</li></ul><p>For completeness, we include a script with all the commands to generate the mesh displayed in the final image. Note, we <strong>do not</strong> include the plotting in this script.</p><pre><code class="language-julia hljs"># Interactive mesh with modified outer and inner curve chains
#
# Create inner / outer boundary chains composed of the four
# available HOHQMesh curve types.
#
# Keywords: outer boundary, inner boundary, parametric equations,
#           circle arcs, cubic spline, curve removal
using HOHQMesh

# Instantiate the project
sandbox_project = newProject(&quot;sandbox&quot;, &quot;out&quot;)

# Add the background grid
addBackgroundGrid!(sandbox_project, [1.0, 1.0, 0.0])

# Create and add the original outer boundary curves
outer_line1 = newEndPointsLineCurve(&quot;Line1&quot;, [0.0, -7.0, 0.0], [5.0,  3.0, 0.0])
outer_line2 = newEndPointsLineCurve(&quot;Line2&quot;, [-5.0, 3.0, 0.0], [0.0, -7.0, 0.0])
outer_arc = newCircularArcCurve(&quot;Arc&quot;,  [0.0, 3.0, 0.0], 5.0, 0.0, 180.0, &quot;degrees&quot;)

addCurveToOuterBoundary!(sandbox_project, outer_line1)
addCurveToOuterBoundary!(sandbox_project, outer_arc)
addCurveToOuterBoundary!(sandbox_project, outer_line2)

# Modify the outer boundary to have a spline instead of a straight line
removeOuterBoundaryCurveWithName!(sandbox_project, &quot;Line2&quot;)

spline_data = [ [0.0  -5.0  3.0 0.0]
                [0.25 -2.0  1.0 0.0]
                [0.5  -4.0  0.5 0.0]
                [0.75 -2.0 -3.0 0.0]
                [1.0   0.0 -7.0 0.0] ]
outer_spline = newSplineCurve(&quot;Spline&quot;, 5, spline_data)
addCurveToOuterBoundary!(sandbox_project, outer_spline)

# Create and add the inner boundary curves
inner_line1 = newEndPointsLineCurve(&quot;Line1&quot;, [1.0, 5.0, 0.0], [1.0, 3.0, 0.0])
inner_line2 = newEndPointsLineCurve(&quot;Line2&quot;, [-1.0, 3.0, 0.0], [-1.0, 5.0, 0.0])
inner_bottom_arc = newCircularArcCurve(&quot;BottomArc&quot;, [0.0, 3.0, 0.0], 1.0, 0.0, -pi, &quot;radians&quot;)
inner_top_arc = newCircularArcCurve(&quot;TopArc&quot;, [0.0, 5.0, 0.0], 1.0, 180.0, 0.0, &quot;degrees&quot;)

addCurveToInnerBoundary!(sandbox_project, inner_line1, &quot;inner&quot;)
addCurveToInnerBoundary!(sandbox_project, inner_bottom_arc, &quot;inner&quot;)
addCurveToInnerBoundary!(sandbox_project, inner_line2, &quot;inner&quot;)
addCurveToInnerBoundary!(sandbox_project, inner_top_arc, &quot;inner&quot;)

# Generate a mesh
generate_mesh(sandbox_project)

# Delete the existing mesh before modifying the inner boundary curve chain
remove_mesh!(sandbox_project)

# Modify the inner boundary curve with an oscillatory line and a new circle arc
removeInnerBoundaryCurve!(sandbox_project, &quot;Line1&quot;, &quot;inner&quot;)
removeInnerBoundaryCurve!(sandbox_project, &quot;BottomArc&quot;, &quot;inner&quot;)

xEqn = &quot;x(t) = t + 1&quot;
yEqn = &quot;y(t) = -2 * t + 5 - 1.5 * cos(pi * t) * sin(pi * t)&quot;
zEqn = &quot;z(t) = 0.0&quot;
inner_eqn = newParametricEquationCurve(&quot;wiggleLine&quot;, xEqn, yEqn, zEqn)

new_bottom_arc = newCircularArcCurve(&quot;wideBottomArc&quot;, [0.5, 3.0, 0.0], 1.5, 0.0, -pi, &quot;radians&quot;)

addCurveToInnerBoundary!(sandbox_project, inner_eqn, &quot;inner&quot;)
addCurveToInnerBoundary!(sandbox_project, new_bottom_arc, &quot;inner&quot;)

# Regenerate the final mesh
generate_mesh(sandbox_project)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../spline_curves/">« Spline curves</a><a class="docs-footer-nextpage" href="../../development/">Development »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Tuesday 30 April 2024 10:53">Tuesday 30 April 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
